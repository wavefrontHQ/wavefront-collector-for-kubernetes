language: go

branches:
  only:
    - master

# workaround for case sensitive build issues with wavefrontHQ
go_import_path: github.com/wavefronthq/wavefront-collector-for-kubernetes

notifications:
  slack:
    if: branch = master
    rooms:
    - 'vmware:yjnIAVzbtdV7vm5Rv5E4J9Tw'
    on_success: always
    on_failure: always

go:
  - "1.15.x"
  - "1.16.x"
script:
  - make checkfmt vet tests
jobs:
  allow_failures:
    - go: "1.16.x"
  fast_finish: true
  include:
    - stage: integration tests
      go: "1.15.x"
      script:
        - ./hack/travis/setup-for-integration-test.sh
        - GKE_CLUSTER_NAME=k8s-saas-travis-ci make gke-connect-to-cluster
        - VERSION_POSTFIX="$([[ $TRAVIS_PULL_REQUEST -ne "false" ]]; echo -n "-pr${TRAVIS_PULL_REQUEST}" || echo -n "")" make integration-test
